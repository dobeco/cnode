webpackJsonp([6],{TO2V:function(t,s){},cOqS:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=e("Dd8w"),a=e.n(i),n=e("7t+N"),o=e.n(n),c=e("NYxO"),r=e("fdFc"),l=e("UzLt"),p=e("BgHB"),u=e("S8yE"),d={name:"topic",components:{vHeader:l.a,tag:p.a,vAlert:u.a},data:function(){return{topic:{},commentContent:"",replyContent:"",show:!1,message:"",reply_id:0}},computed:a()({},Object(c.b)(["user"])),created:function(){this.getLastTime=r.a,this.getTagInfo=r.b,this.getTopicDetail()},updated:function(){var t=this;o()("#textarea").focus(function(){t.reply_id=0}),this.lazyLoad(),o()(window).scroll(this.lazyLoad)},methods:{getTopicDetail:function(){var t=this,s="https://cnodejs.org/api/v1/topic/"+this.$route.params.id+"?mdrender=true&accesstoken="+this.user.accessToken;o.a.get(s).then(function(s){s.success&&(t.topic=s.data)}).catch(function(){t.$router.push("/404")})},lazyLoad:function(){o()(".reply-list .avatar").each(function(){var t=window.pageYOffset+window.innerHeight;this.offsetTop<=t&&(this.src=o()(this).attr("data-src"))})},collectTopic:function(){var t=this;if(this.topic.is_collect){o.a.post("https://cnodejs.org/api/v1/topic_collect/de_collect",{accesstoken:this.user.accessToken,topic_id:this.$route.params.id}).then(function(s){s.success&&(t.topic.is_collect=!1)})}else{o.a.post("https://cnodejs.org/api/v1/topic_collect/collect",{accesstoken:this.user.accessToken,topic_id:this.$route.params.id}).then(function(s){s.success&&(t.topic.is_collect=!0)})}},comment:function(t,s){var e=this,i="https://cnodejs.org/api/v1/topic/"+this.$route.params.id+"/replies";if(!s)return this.tip("[评论/回复]内容不能为空");o.a.post(i,{accesstoken:this.user.accessToken,content:s.trim(),reply_id:t}).then(function(t){t.success&&(e.tip("[评论/回复]发表成功"),setTimeout(function(){window.location.reload(!0)},2e3))}).catch(function(t){e.tip(t.responseJSON.error_msg)})},cancelComment:function(){this.commentContent=""},replyOthers:function(t){if(!this.user.id)return this.$router.push("/login?origin="+this.$route.fullPath);this.reply_id=t.id,this.replyContent="@"+t.author.loginname+" "},cancelReplyOthers:function(){this.reply_id=0,this.replyContent=""},ups:function(t){if(!this.user.id)return this.$router.push("/login?origin="+this.$route.fullPath);var s="https://cnodejs.org/api/v1/reply/"+t.id+"/ups";o.a.post(s,{accesstoken:this.user.accessToken}).then(function(s){s.success&&("up"===s.action?(t.ups.push("up"),t.is_uped=!0):"down"===s.action&&(t.ups.pop(),t.is_uped=!1))})},tip:function(t){var s=this,e=null;clearTimeout(e),this.show=!0,this.message=t,e=setTimeout(function(){s.show=!1},2e3)}}},h={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"topic"},[i("v-header",{attrs:{head:"主题"}}),t._v(" "),t.topic.id?[i("h2",{staticClass:"title"},[t._v(t._s(t.topic.title))]),t._v(" "),i("div",{staticClass:"author-info"},[i("router-link",{attrs:{to:"/user/topic.author.loginname"}},[i("img",{staticClass:"avatar",attrs:{src:t.topic.author.avatar_url,width:"40",height:"40"}})]),t._v(" "),i("div",{staticClass:"center"},[i("div",{staticClass:"base"},[i("span",{staticClass:"name"},[t._v(t._s(t.topic.author.loginname))]),t._v(" "),i("span",{staticClass:"name"},[t._v(t._s(t.getLastTime(t.topic.create_at)))])]),t._v(" "),t.topic.author.loginname===t.user.name?i("router-link",{staticClass:"edit",attrs:{to:"/topic/"+t.topic.id+"/edit"}},[t._v("编辑\n        ")]):t._e()],1),t._v(" "),i("div",{staticClass:"right"},[t.user.id?i("button",{staticClass:"collect",class:{cancel:t.topic.is_collect},on:{click:t.collectTopic}},[t._v(t._s(t.topic.is_collect?"取消收藏":"收藏")+"\n        ")]):t._e(),t._v(" "),i("div",{staticClass:"visit"},[i("tag",{attrs:{type:t.getTagInfo(t.topic).className,text:t.getTagInfo(t.topic).text}}),t._v(" "),i("span",[t._v(t._s(t.topic.visit_count)+"次浏览")])],1)])],1),t._v(" "),i("div",{staticClass:"topic-content markdown-body",domProps:{innerHTML:t._s(t.topic.content)}}),t._v(" "),t.user.id?i("div",{staticClass:"comment-wrapper"},[i("div",{staticClass:"comment"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentContent,expression:"commentContent"}],attrs:{id:"textarea",placeholder:"写下你的评论..."},domProps:{value:t.commentContent},on:{input:function(s){s.target.composing||(t.commentContent=s.target.value)}}}),t._v(" "),i("div",{staticClass:"ctrl"},[i("span",{staticClass:"cancel",on:{click:t.cancelComment}},[t._v("取消")]),t._v(" "),i("button",{staticClass:"send",on:{click:function(s){t.comment(0,t.commentContent)}}},[t._v("发送")])])])]):t._e(),t._v(" "),t.topic.replies.length?[i("h3",[i("b",[t._v(t._s(t.topic.replies.length))]),t._v(" 回复")]),t._v(" "),i("ul",{staticClass:"reply-list"},t._l(t.topic.replies,function(s,a){return i("li",[i("div",{staticClass:"base"},[i("router-link",{attrs:{to:"/user/"+s.author.loginname}},[i("img",{staticClass:"avatar",attrs:{src:e("Gj/C"),"data-src":s.author.avatar_url,width:"40",height:"40"}})]),t._v(" "),i("div",{staticClass:"center"},[i("p",{staticClass:"author-name"},[t._v(t._s(s.author.loginname))]),t._v(" "),i("time",[t._v(t._s(t.getLastTime(s.create_at)))])]),t._v(" "),i("span",{staticClass:"floor"},[t._v(t._s(a+1)+"楼")])],1),t._v(" "),i("div",{staticClass:"markdown-body content",domProps:{innerHTML:t._s(s.content)}}),t._v(" "),i("div",{staticClass:"action"},[i("span",{staticClass:"num",class:{is_uped:s.is_uped}},[t._v(t._s(s.ups.length?s.ups.length:""))]),t._v(" "),i("i",{staticClass:"icon-awesome",class:{is_uped:s.is_uped},on:{click:function(e){t.ups(s)}}}),t._v(" "),i("i",{staticClass:"icon-reply",on:{click:function(e){t.replyOthers(s)}}})]),t._v(" "),i("transition",{attrs:{name:"comment"}},[t.reply_id===s.id?i("div",{staticClass:"comment between"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.replyContent,expression:"replyContent"}],attrs:{placeholder:"写下你的回复..."},domProps:{value:t.replyContent},on:{input:function(s){s.target.composing||(t.replyContent=s.target.value)}}}),t._v(" "),i("div",{staticClass:"ctrl"},[i("span",{staticClass:"cancel",on:{click:t.cancelReplyOthers}},[t._v("取消")]),t._v(" "),i("button",{staticClass:"send",on:{click:function(e){t.comment(s.id,t.replyContent)}}},[t._v("发送")])])]):t._e()])],1)}))]:i("p",{staticClass:"no-reply"},[t._v("暂无回复")])]:t._e(),t._v(" "),i("v-alert",{attrs:{text:t.message,show:t.show}})],2)},staticRenderFns:[]};var v=e("VU/8")(d,h,!1,function(t){e("TO2V")},null,null);s.default=v.exports}});
//# sourceMappingURL=6.fbd12619bbc79020cf67.js.map